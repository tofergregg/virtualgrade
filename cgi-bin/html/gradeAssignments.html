<!doctype html>
<html>
<head>
  <!--<link rel="stylesheet" type="text/css" href="grade_a_page.css"> -->
  <title>Virtual Grade</title>
</head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>
<script type="text/javascript">
var userToken = '';
var remoteUser = '';
function init(){
    $("#progressIndicator").html("<img src='../data/indicator.gif'>");
    document.getElementById('semester').onchange = function(){
        populateOptions('department',
                        document.getElementById('semester').value);
        };
    document.getElementById('department').onchange = function(){
        populateOptions('course',
                        document.getElementById('semester').value+'/'+
                        document.getElementById('department').value);
        };
    document.getElementById('course').onchange = function(){
        populateOptions('assignment',
                        document.getElementById('semester').value+'/'+
                        document.getElementById('department').value+'/'+
                        document.getElementById('course').value);
        };
    document.getElementById('assignment').onchange = function(){
        return;
        };
    
    $.post("findAssignments.cgi", null, function (data){
        init.assignmentListing = data;
        console.log(data);
        populateOptions('semester','','2014-fall');
        $("#progressIndicator").html("");
    });
}

function populateOptions(selectId,rootOption,optionChoice){
    var assignmentListing = init.assignmentListing;
    // remove all options first
    var obj=document.getElementById(selectId);

    while(obj.options.length > 0)             
        obj.remove(0);
    
    for (i=0;i<assignmentListing[selectId].length;i++){
                optChoice = assignmentListing[selectId][i];
                if (selectId=='department'){
                        if (!possibleOption('semester',optChoice[0]))
                                continue;
                }
                else if (selectId=='course'){
                        if (!possibleOption('semester',optChoice[0]))
                                continue;
                        if (!possibleOption('department',optChoice[1]))
                                continue;
                }
                else if (selectId=='assignment'){
                        if (!possibleOption('semester',optChoice[0]))
                                continue;
                        if (!possibleOption('department',optChoice[1]))
                                continue;
                        if (!possibleOption('course',optChoice[2]))
                                continue;
                }
                opt = document.createElement("option");
                opt.value = optChoice[optChoice.length-1];
                opt.text=optChoice[optChoice.length-1];
                obj.appendChild(opt);
    }
    if(typeof(optionChoice)!='undefined') {
        document.getElementById(selectId).value=optionChoice;
    }
    else {
        document.getElementById(selectId).selectedIndex=0;
    }
    document.getElementById(selectId).onchange();    
}
function possibleOption(selectId,optChoice){
        parentObjChoice = document.getElementById(selectId).value;
        if (parentObjChoice != optChoice) return false;
        return true;
}
function submitForm(){
    semester=document.getElementById('semester').value;
    department=document.getElementById('department').value;
    course=document.getElementById('course').value;
    assignment=document.getElementById('assignment').value;
    console.log(userToken);
    window.location = 'loadPage.cgi?&page='+'gradeAnAssignment'+
                                    '&userToken='+userToken+
                                    '&semester='+semester+
                                    '&department='+department+
                                    '&course='+course+
                                    '&assignment='+assignment+
                                    '&remoteUser='+remoteUser;
}
function login(){
    $.post("remoteUser.cgi", {}, 
                function (data){
                    console.log(data);
                    login.remoteUser = data['remoteUser'];
                    login.rights= data['rights'];
                    if (data.rights.indexOf('admin')!= -1) {
                        // load setup page
                        window.location = 'loadPage.cgi?userToken=""&page=startAdmin'+
                                    '&remoteUser='+login.remoteUser;
                    }
                    else if (data.rights.indexOf('grader') != -1) {
                        // load grading page
                    }
                    else {
                        alert('Unauthorized User. Please see a faculty member for assistance.');
                    }
            });
}
</script>
<body onload="init()">
    <p style="font-size:20px">
    <b><a href="javascript:login();">Virtual Grade</a></b>
    <p>
    <span id="progressIndicator"></span>
    <p>
    Select Semester:
    <select name="semester" id="semester" val='0'>
        <span id='semesterOptionSpan'></span>
    </select>
    <p>
    <p>
    Select Department:
    <select name='department' id='department' val='1>
        <span id='semesterOptionSpan'></span>
    </select>
    <p>
    Select Course:
    <select name='course' id='course' val='2'>
        <span id='courseOptionSpan'></span>
    </select>
    <p>
    Select Assignment:
    <select name='assignment' id='assignment' val='4'>
        <span id='assignmentOptionSpan'></span>
    </select>
    <p>
    <input type='button' id='submitCourse' value='Submit' onclick="submitForm()">
    <p>
    <span id="extraInfo"></span>
</body>
</html>